var Todo={tempUpdateIndex:"",init:function(){this.checkDB(),this.cacheDom(),this.bindEvents(),this.renderTasks(),this.initDatesInForm()},checkDB:function(){var t=localStorage.getItem("todoList");null===t?this.tasks=[]:this.tasks=JSON.parse(t)},initDatesInForm:function(){this.$formTodaysDate.val($.datepicker.formatDate("yy-mm-dd",new Date)).attr("disabled","true"),this.$formDueDate.datepicker({dateFormat:"yy-mm-dd",firstDay:1,minDate:-1})},makeTasksDraggable:function(){this.$tasksUL.sortable({axis:"y",handle:".move-icon",classes:{"ui-sortable-helper":"moving-task"}})},cacheDom:function(){this.$form=$("#add-form"),this.$formAddButton=$("#add-button"),this.$formUpdateButton=$("#update-button"),this.$formTodaysDate=$("#date"),this.$formDueDate=$("#due"),this.$formHeading=$("#heading"),this.$formDesc=$("#desc"),this.$formPrio=$("#prio"),this.$tasksUL=$("#tasks"),this.$editBtn=$("#edit-btn"),this.$editBtns=$(".edit-btns")},getFormValues:function(){var t={addedDate:this.$formTodaysDate.val(),dueDate:this.$formDueDate.val(),heading:this.$formHeading.val(),desc:this.$formDesc.val(),priority:this.$formPrio.children(".active").find("input").data("prio"),id:this.tasks.length+1,isDone:!1};return t},clearForm:function(){this.$formDueDate.val(""),this.$formHeading.val(""),this.$formDesc.val("")},bindEvents:function(){var t=this;this.$formAddButton.on("click",this.addTask),$(document).on("click","#"+this.$editBtn.attr("id"),this.toggleEditMode),$(document).on("click",".edit-btns button",function(s){var e=$(this),a=e.parent().parent().data("task-id"),i=e.data("action");"doneAction"===i?t.toggleMarkDone(a):"editAction"===i?t.editTask(a):"deleteAction"===i&&t.deleteTask(a)}),$(document).on("click","#update-button",this.updateTask),$(document).on("keydown",function(s){27===s.keyCode&&(console.log("Array:"),console.log(t.tasks))}),$(".clearLS").on("click",function(){localStorage.clear(),console.log("localStorage cleared"),Todo.tasks=[]})},toggleEditMode:function(){var t=Todo;t.cacheDom(),t.$editBtns.toggleClass("edit-mode")},addTask:function(t){t.preventDefault();var s=Todo,e=s.getFormValues();s.validateForm()&&(s.tasks.push(e),s.updateDB(),s.clearForm())},updateDB:function(t){localStorage.setItem("todoList",JSON.stringify(this.tasks)),t||this.renderTasks()},validateForm:function(){var t=this.getFormValues(),s=/[0-9]{4}\-[0-9]{2}\-[0-9]{2}/,e=/[0-9]{4}\-[0-9]{2}\-[0-9]{2}/,a=/.{1,50}/,i,o=!0;return t.addedDate.match(s)?this.$formTodaysDate.parent().removeClass("has-error").find(".help-block").remove():(o=!1,i="The date has to be in format YYYY-MM-DD",this.$formTodaysDate.parent().addClass("has-error").prepend('<span class="help-block">'+i+"</span>")),t.dueDate.match(e)?this.$formDueDate.parent().removeClass("has-error").find(".help-block").remove():(o=!1,i="The date has to be in format YYYY-MM-DD",this.$formDueDate.parent().addClass("has-error").prepend('<span class="help-block">'+i+"</span>")),t.heading.match(a)?this.$formHeading.parent().removeClass("has-error").find(".help-block").remove():(o=!1,i="The heading has to be 1-50 characters",this.$formHeading.parent().addClass("has-error").prepend('<span class="help-block">'+i+"</span>")),t.desc.length<=0||t.desc.length>200?(o=!1,i="The description has to be 1-200 characters",this.$formDesc.parent().addClass("has-error").prepend('<span class="help-block">'+i+"</span>")):this.$formDesc.parent().removeClass("has-error").find(".help-block").remove(),o},renderTasks:function(){this.$tasksUL.html(""),0===this.tasks.length?(this.$tasksUL.html("<h2>You have no tasks!</h2>"),this.$editBtn.hide()):this.$editBtn.show();for(var t=0;t<this.tasks.length;t++){var s="",e,a="",i,o,n="";1===this.tasks[t].priority?e="!":2===this.tasks[t].priority?e="!!":3===this.tasks[t].priority&&(e="!!!"),i=(new Date).getTime(),o=Date.parse(this.tasks[t].dueDate),o<i&&(n=" item-dued"),this.tasks[t].isDone&&(a=" item-done"),s+='<li data-task-id="'+this.tasks[t].id+'" class="task list-group-item'+a+n+'">',o<i&&(s+='<span class="due-warning">DUE DATE PAST</span>'),s+='<span class="date"><span class="glyphicon glyphicon-calendar"></span> '+this.tasks[t].addedDate+"</span>",s+='<h4><span class="prio">'+e+"</span> "+this.tasks[t].heading+"</h4>",s+='<p class="desc">'+this.tasks[t].desc+"</p>",s+='<span class="due"><span class="glyphicon glyphicon-time"></span> '+this.tasks[t].dueDate+"</span>",s+='<div class="btn-group btn-group-lg edit-btns">',s+='<button type="button" data-action="doneAction" class="btn btn-default">',s+='<span class="glyphicon glyphicon-check text-success"></span>',s+="</button>",s+='<button type="button" data-action="editAction" class="btn btn-default">',s+='<span class="glyphicon glyphicon-edit text-warning"></span>',s+="</button>",s+='<button type="button" data-action="deleteAction" class="btn btn-default">',s+='<span class="glyphicon glyphicon-remove-circle text-danger"></span>',s+="</button>",s+="</div>",s+="</li>",this.$tasksUL.append(s)}},toggleMarkDone:function(t){for(var s=0;s<this.tasks.length;s++)if(this.tasks[s].id===t){var e=$("[data-task-id="+t+"]");e.hasClass("item-done")?(this.tasks[s].isDone=!1,e.removeClass("item-done")):(this.tasks[s].isDone=!0,e.addClass("item-done"));break}this.toggleEditMode(),this.updateDB(!0)},deleteTask:function(t){for(var s,e=this,a=0;a<this.tasks.length;a++)if(this.tasks[a].id===t){var i=$("[data-task-id="+t+"]");s=a;break}this.tasks.splice(s,1),this.toggleEditMode(),i.slideUp(function(){e.updateDB(),$(this).remove()})},editTask:function(t){for(var s=this,e,a=0;a<this.tasks.length;a++)this.tasks[a].id===t&&(e=this.tasks.indexOf(this.tasks[a]));this.fillForm(e),this.toggleEditMode(),this.taskInArrayToEdit=e},fillForm:function(t){this.$formDueDate.val(this.tasks[t].dueDate),this.$formHeading.val(this.tasks[t].heading),this.$formDesc.val(this.tasks[t].desc),1===this.tasks[t].priority?this.$formPrio.find("label:nth-child(1)").trigger("click"):2===this.tasks[t].priority?this.$formPrio.find("label:nth-child(2)").trigger("click"):3===this.tasks[t].priority&&this.$formPrio.find("label:nth-child(3)").trigger("click"),this.$formAddButton.toggle(),this.$formUpdateButton.toggle(),this.tempUpdateIndex=t},updateTask:function(t){t.preventDefault();var s=Todo,e=s.tempUpdateIndex,a=s.getFormValues();a.id=s.tasks[e].id,s.tasks[e]=a,s.updateDB(),s.$formAddButton.toggle(),s.$formUpdateButton.toggle(),s.clearForm()}};$(document).ready(function(){Todo.init()});
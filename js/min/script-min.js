var Todo={init:function(){this.checkDB(),this.cacheDom(),this.bindEvents(),this.renderTasks(),this.initDatesInForm(),this.makeTasksDraggable()},checkDB:function(){var t=localStorage.getItem("todoList");null===t?this.tasks=[]:this.tasks=JSON.parse(t)},initDatesInForm:function(){this.$formTodaysDate.val($.datepicker.formatDate("yy-mm-dd",new Date)).attr("disabled","true"),this.$formDueDate.datepicker({dateFormat:"yy-mm-dd",firstDay:1,minDate:-1})},makeTasksDraggable:function(){this.$tasksUL.sortable({axis:"y",handle:".move-icon",classes:{"ui-sortable-helper":"moving-task"}})},cacheDom:function(){this.$form=$("#add-form"),this.$formAddButton=$("#add-button"),this.$formTodaysDate=$("#date"),this.$formDueDate=$("#due"),this.$formHeading=$("#heading"),this.$formDesc=$("#desc"),this.$formPrio=$("#prio"),this.$tasksUL=$("#tasks"),this.$editBtn=$("#edit-btn"),this.$editBtns=$(".edit-btns")},getFormValues:function(){var t={todaysDate:this.$formTodaysDate.val(),dueDate:this.$formDueDate.val(),heading:this.$formHeading.val(),desc:this.$formDesc.val(),priority:this.$formPrio.children(".active").find("input").data("prio"),id:this.tasks.length+1,isDone:!1};return t},bindEvents:function(){this.$formAddButton.on("click",this.addTask),$(document).on("click","#"+this.$editBtn.attr("id"),this.toggleEditMode),$(document).on("click",".edit-btns button",this.doActionWithItem),$(document).on("keydown",function(t){27===t.keyCode&&(console.log("Array:"),console.log(Todo.tasks))}),$(".clearLS").on("click",function(){localStorage.clear(),console.log("localStorage cleared"),Todo.tasks=[]})},toggleEditMode:function(){var t=Todo;t.cacheDom(),t.$editBtns.toggleClass("edit-mode")},addTask:function(t){t.preventDefault();var s=Todo;s.validateForm()&&s.pushToArray()},pushToArray:function(){var t=this.getFormValues();this.tasks.push(t),this.updateDB()},updateDB:function(t){localStorage.setItem("todoList",JSON.stringify(this.tasks)),t||this.renderTasks()},validateForm:function(){var t=this.getFormValues(),s=/[0-9]{4}\-[0-9]{2}\-[0-9]{2}/,a=/[0-9]{4}\-[0-9]{2}\-[0-9]{2}/,e=/.{1,50}/,i,o=!0;return t.todaysDate.match(s)?this.$formTodaysDate.parent().removeClass("has-error").find(".help-block").remove():(o=!1,i="The date has to be in format YYYY-MM-DD",this.$formTodaysDate.parent().addClass("has-error").prepend('<span class="help-block">'+i+"</span>")),t.dueDate.match(a)?this.$formDueDate.parent().removeClass("has-error").find(".help-block").remove():(o=!1,i="The date has to be in format YYYY-MM-DD",this.$formDueDate.parent().addClass("has-error").prepend('<span class="help-block">'+i+"</span>")),t.heading.match(e)?this.$formHeading.parent().removeClass("has-error").find(".help-block").remove():(o=!1,i="The heading has to be 1-50 characters",this.$formHeading.parent().addClass("has-error").prepend('<span class="help-block">'+i+"</span>")),t.desc.length<=0||t.desc.length>200?(o=!1,i="The description has to be 1-200 characters",this.$formDesc.parent().addClass("has-error").prepend('<span class="help-block">'+i+"</span>")):this.$formDesc.parent().removeClass("has-error").find(".help-block").remove(),o},renderTasks:function(){this.$tasksUL.html(""),0===this.tasks.length?(this.$tasksUL.html("<h2>You have no tasks!</h2>"),this.$editBtn.hide()):this.$editBtn.show();for(var t=0;t<this.tasks.length;t++){var s="",a,e;1===this.tasks[t].priority?a="!":2===this.tasks[t].priority?a="!!":3===this.tasks[t].priority&&(a="!!!"),e=this.tasks[t].isDone?" item-done":"",s+='<li data-task-id="'+this.tasks[t].id+'" class="task list-group-item'+e+'">',s+='<span class="date"><span class="glyphicon glyphicon-calendar"></span> '+this.tasks[t].todaysDate+"</span>",s+='<h4><span class="prio">'+a+"</span> "+this.tasks[t].heading+"</h4>",s+='<p class="desc">'+this.tasks[t].desc+"</p>",s+='<span class="due"><span class="glyphicon glyphicon-time"></span> '+this.tasks[t].dueDate+"</span>",s+='<span class="move-icon glyphicon glyphicon-menu-hamburger"></span>',s+='<div class="btn-group btn-group-lg edit-btns">',s+='<button type="button" data-action="doneAction" class="btn btn-default">',s+='<span class="glyphicon glyphicon-check text-success"></span>',s+="</button>",s+='<button type="button" data-action="editAction" class="btn btn-default">',s+='<span class="glyphicon glyphicon-edit text-warning"></span>',s+="</button>",s+='<button type="button" data-action="deleteAction" class="btn btn-default">',s+='<span class="glyphicon glyphicon-remove-circle text-danger"></span>',s+="</button>",s+="</div>",s+="</li>",this.$tasksUL.append(s)}},doActionWithItem:function(){var t=Todo,s=$(this),a=s.parent().parent().data("task-id"),e=s.data("action");"doneAction"===e?t.toggleMarkDone(a):"editAction"===e?t.editTask(a):"deleteAction"===e&&t.deleteTask(a)},toggleMarkDone:function(t){for(var s=0;s<this.tasks.length;s++)if(this.tasks[s].id===t){var a=$("[data-task-id="+t+"]");a.hasClass("item-done")?(this.tasks[s].isDone=!1,a.removeClass("item-done")):(this.tasks[s].isDone=!0,a.addClass("item-done"));break}this.toggleEditMode(),this.updateDB(!0)},deleteTask:function(t){for(var s,a=this,e=0;e<this.tasks.length;e++)if(this.tasks[e].id===t){var i=$("[data-task-id="+t+"]");s=e;break}this.tasks.splice(s,1),this.toggleEditMode(),i.slideUp(function(){a.updateDB(),$(this).remove()})},editTask:function(t){for(var s=0;s<this.tasks.length;s++);}};$(document).ready(function(){Todo.init()});